"use strict";(self.webpackChunk_mssfoobar_docs=self.webpackChunk_mssfoobar_docs||[]).push([[8067],{59967:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"contributing/development/logging","title":"Logging","description":"The ultimate purpose of standardizing our logging and exception handling is to make it easier to debug the system.","source":"@site/docs/contributing/development/logging.md","sourceDirName":"contributing/development","slug":"/contributing/development/logging","permalink":"/docs/docs/contributing/development/logging","draft":false,"unlisted":false,"editUrl":"https://github.com/mssfoobar/docs/tree/main/docs/contributing/development/logging.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"Logging"},"sidebar":"contributingSidebar","previous":{"title":"Development Conventions","permalink":"/docs/docs/contributing/development/conventions"},"next":{"title":"Overview","permalink":"/docs/docs/contributing/documentation/overview"}}');var o=i(74848),t=i(28453);const r={sidebar_position:3,sidebar_label:"Logging"},l="Logging",a={},d=[{value:"General Logging Guidelines",id:"general-logging-guidelines",level:2},{value:"TypeScript, Svelte (Frontend)",id:"typescript-svelte-frontend",level:2},{value:"Format",id:"format",level:3},{value:"Retries",id:"retries",level:3},{value:"Golang (Backend)",id:"golang-backend",level:2},{value:"Logging",id:"logging-1",level:3},{value:"Error Handling",id:"error-handling",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"logging",children:"Logging"})}),"\n",(0,o.jsx)(n.h1,{id:"logging--exception-handling",children:"Logging & Exception Handling"}),"\n",(0,o.jsx)(n.p,{children:"The ultimate purpose of standardizing our logging and exception handling is to make it easier to debug the system.\nLogging in a specific format allows us to filter logs across services, and standardizing exception handling allows us\nto make better sense of the errors thrown."}),"\n",(0,o.jsx)(n.h2,{id:"general-logging-guidelines",children:"General Logging Guidelines"}),"\n",(0,o.jsxs)(n.p,{children:["The following is a list of recommendations we have for what should be printed at which log levels. The recommendations\nare based on the assumption that the system will be running at ",(0,o.jsx)(n.code,{children:"INFO"})," level when in production mode."]}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Log Level"}),(0,o.jsx)(n.th,{children:"Example"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"DEBUG"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"request received, show all inputs"})}),(0,o.jsx)(n.td,{children:"Provide information that can be used to diagnose issues especially those related to program state."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"INFO"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"server ready to listen to requests"})}),(0,o.jsx)(n.td,{children:"Record events that indicate that program is functioning normally."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"WARN"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"no host name supplied, using default value"})}),(0,o.jsx)(n.td,{children:"Record potential issues in your application. They may not be might need to be investigated."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"ERROR"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"failed to connect to database"})}),(0,o.jsx)(n.td,{children:"Records unexpected errors that occur during the operation of your application. In most cases, the error should be addressed as soon as possible to prevent further problems or outages."})]})]})]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"TRACE"})," and ",(0,o.jsx)(n.code,{children:"FATAL"})," might be supported by different logging frameworks in different languages. Since we support multiple\nlanguages, we will not restrict these log levels, however we don't have official recommendations on what must be\nlogged at these levels, except that ",(0,o.jsx)(n.code,{children:"TRACE"})," be the lowest log level (most verbose), and ",(0,o.jsx)(n.code,{children:"FATAL"})," be the highest log\nlevel (printed at all log levels)."]}),"\n",(0,o.jsx)(n.h2,{id:"typescript-svelte-frontend",children:"TypeScript, Svelte (Frontend)"}),"\n",(0,o.jsx)(n.h3,{id:"format",children:"Format"}),"\n",(0,o.jsx)(n.p,{children:"The logs must be formatted as a JSON - this allows us to perform searches based on the key, as well as pretty print\nthe logs using tools:"}),"\n",(0,o.jsx)(n.p,{children:"It must minimally have one of the following log levels:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"DEBUG"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"INFO"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"WARN"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"ERROR"})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "level": "INFO",\n    ...\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Any other data can then be included as more keys in the log object:"}),"\n",(0,o.jsx)(n.p,{children:"Example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n\t"level": "ERROR",\n\t"timestamp": "2023-10-25T03:06:23.423+0000",\n\t"message": "Failed to secure the crown jewels. Aborting."\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"retries",children:"Retries"}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["TLDR; errors that result in retries should be logged as ",(0,o.jsx)(n.code,{children:"WARN"})]})}),"\n",(0,o.jsxs)(n.p,{children:["Often, there might be processes that result in errors that are actually anticpated or expected (for example, token\nexpiries, or network errors might be retried) - these errors might be retried, and succeeded. In those scenarios, the\nerrors should be logged with ",(0,o.jsx)(n.code,{children:"WARN"}),", only the final error should be logged as ",(0,o.jsx)(n.code,{children:"ERROR"}),", or maybe even ",(0,o.jsx)(n.code,{children:"FATAL"})," in\nfatal/panic scenarios."]}),"\n",(0,o.jsx)(n.h2,{id:"golang-backend",children:"Golang (Backend)"}),"\n",(0,o.jsx)(n.h3,{id:"logging-1",children:"Logging"}),"\n",(0,o.jsx)(n.p,{children:"Logging should be in JSON structured format to make it easier to be read, searched and analyzed by any application or an\ninterested individual."}),"\n",(0,o.jsxs)(n.p,{children:["We use ",(0,o.jsx)(n.code,{children:"aohlog"})," package from ",(0,o.jsx)(n.a,{href:"https://github.com/mssfoobar/aoh-golib",children:"aoh-golib"}),". ",(0,o.jsx)(n.code,{children:"aohlog"})," is built on top of the\npopular logging library zap by uber with preconfiguration to suite AOH framework."]}),"\n",(0,o.jsx)(n.p,{children:"Below is the supported log levels"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"DEBUG"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"INFO"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"WARN"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"ERROR"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"PANIC"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"FATAL"})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'import (\n    aohlog "github.com/mssfoobar/aoh-golib/logger"\n    "go.uber.org/zap"\n)\n\nfunc main() {\n    // by default aohlog set log level to Production which log at `INFO` or above log level\n    // if you want to see log at `DEBUG` or above, set it explicitly\n    aohlog.SetDevelopment()\n\n    // aohlog.SetProduction() // if uncommented, this will set the log level back to `INFO`\n\n    aohlog.Debug("This is a DEBUG message")\n    aohlog.Info("This is an INFO message")\n    aohlog.Info("This is an INFO message with additional fields", zap.String("region", "us-west"), zap.Int("id", 2))\n    aohlog.Warn("This is a WARN message")\n    aohlog.Error("This is an ERROR message")\n    // aohlog.Panic("This is a Panic message")   // would exit if uncommented\n    // aohlog.Fatal("This is a FATAL message")   // would exit if uncommented\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Logging at development mode will print the log in semi-structured format which is easier for human to read."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:'2024-08-16T11:58:20.938+0800    DEBUG   example/main.go:15 This is a DEBUG message\n2024-08-16T11:58:20.938+0800    INFO    example/main.go:16 This is an INFO message\n2024-08-16T11:58:20.938+0800    INFO    example/main.go:17 This is an INFO message with additional fields  {"region": "us-west", "id": 2}\n2024-08-16T11:58:20.938+0800    WARN    example/main.go:18 This is a WARN message\n2024-08-16T11:58:20.938+0800    ERROR   example/main.go:19 This is an ERROR message\n'})}),"\n",(0,o.jsx)(n.p,{children:"Logging at production mode will print the log in json structured format which is easier for machine to parse and\nanalyze."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:'{"level":"INFO","ts":"2024-07-19T16:46:45.726+0800","caller":"example/main.go:10","msg":"This is an INFO message"}\n{"level":"INFO","ts":"2024-07-19T16:46:45.726+0800","caller":"example/main.go:11","msg":"This is an INFO message with fields","region":"us-west","id":2}\n{"level":"WARN","ts":"2024-07-19T16:46:45.726+0800","caller":"example/main.go:12","msg":"This is a WARN message"}\n{"level":"ERROR","ts":"2024-07-19T16:46:45.726+0800","caller":"example/main.go:13","msg":"This is an ERROR message"}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"/docs/docs/contributing/language-specific/golang#errors",children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"GO CODING GUIDE"})})})})," already covers how to handle error. This section on\nerror handling is just a reiteration of it to handle error by logging."]})}),"\n",(0,o.jsx)(n.p,{children:"Logging is a part of error handling. If the application encounters an error, use an appropriate log level to\nlog it."}),"\n",(0,o.jsx)(n.p,{children:"Don't log the error every time one occurs, as doing so will create duplicate logs in your application.\nInstead, return the error to the caller and let it log the error when appropriate."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"FATAL"})," should be only used at the highest level in your code which is at the ",(0,o.jsx)(n.code,{children:"main()"})," function.\n",(0,o.jsx)(n.code,{children:"FATAL"})," logs the message and then immediately calls ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:"os.Exit(1)"})}),". This can have several consequences such as"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"defer statements in other goroutines don't run"}),"\n",(0,o.jsx)(n.li,{children:"buffers aren't flushed"}),"\n",(0,o.jsx)(n.li,{children:"temporary files and directories aren't removed"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var s=i(96540);const o={},t=s.createContext(o);function r(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);