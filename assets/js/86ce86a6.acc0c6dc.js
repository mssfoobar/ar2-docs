"use strict";(self.webpackChunk_mssfoobar_docs=self.webpackChunk_mssfoobar_docs||[]).push([[430],{10179:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"modules/prerequisites/local-development","title":"Overview","description":"AGIL Ops Hub maintains a set of docker-compose files in the","source":"@site/docs/modules/prerequisites/local-development.mdx","sourceDirName":"modules/prerequisites","slug":"/modules/prerequisites/local-development","permalink":"/docs/docs/modules/prerequisites/local-development","draft":false,"unlisted":false,"editUrl":"https://github.com/mssfoobar/docs/tree/main/docs/modules/prerequisites/local-development.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"sidebar_label":"Local Development"},"sidebar":"modulesSidebar","previous":{"title":"Tools","permalink":"/docs/docs/modules/prerequisites/tools"},"next":{"title":"Overview","permalink":"/docs/docs/modules/web-base/overview"}}');var s=o(74848),t=o(28453);const a={sidebar_position:4,sidebar_label:"Local Development"},r="Overview",l={},d=[{value:"Guide",id:"guide",level:2},{value:"1. Clone the repository",id:"1-clone-the-repository",level:3},{value:"1.1 - Clone the git repository",id:"11---clone-the-git-repository",level:4},{value:"1.2 - Navigate into the root folder",id:"12---navigate-into-the-root-folder",level:4},{value:"2. Set up the environment variables",id:"2-set-up-the-environment-variables",level:3},{value:"2.1 - Make a copy of the file and rename it to <code>.env</code>",id:"21---make-a-copy-of-the-file-and-rename-it-to-env",level:4},{value:"2.2 - Choose a suitable password and set it for both variables.",id:"22---choose-a-suitable-password-and-set-it-for-both-variables",level:4},{value:"3. Run the command for the module you want",id:"3-run-the-command-for-the-module-you-want",level:3},{value:"3.1 - Example, for the <code>IAN</code> module, you can run it like so.",id:"31---example-for-the-ian-module-you-can-run-it-like-so",level:4},{value:"Additional Configuration",id:"additional-configuration",level:2},{value:"Wildcard DNS vs Host file",id:"wildcard-dns-vs-host-file",level:4},{value:"Wildcard DNS (nip.io)",id:"wildcard-dns-nipio",level:3},{value:"Host file",id:"host-file",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Updating Container Images",id:"updating-container-images",level:3},{value:"Changing Env Vars",id:"changing-env-vars",level:3},{value:"Unable to login to Keycloak",id:"unable-to-login-to-keycloak",level:3},{value:"Podman",id:"podman",level:3},{value:"Credential issues when migrating from Docker",id:"credential-issues-when-migrating-from-docker",level:4},{value:"Traefik",id:"traefik",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"overview",children:"Overview"})}),"\n",(0,s.jsxs)(n.p,{children:["AGIL Ops Hub maintains a set of ",(0,s.jsx)(n.code,{children:"docker-compose"})," files in the\n",(0,s.jsx)(n.a,{href:"https://github.com/mssfoobar/dev-containers",children:"dev-containers repository"}),". If you wish to run any module locally, the\neasiest way to get all their dependencies up and running is by using this\nrepository."]}),"\n",(0,s.jsxs)(n.p,{children:["The following document explains how you can use the ",(0,s.jsx)(n.code,{children:"dev-containers"})," repository to quickly get a local development\nenvironment up and running."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["We use ",(0,s.jsx)(n.a,{href:"https://podman-desktop.io/",children:"Podman Desktop"})," because it works across Windows, macOS, and Linux, and its free - so\nthe rest of the instructions here will be with ",(0,s.jsx)(n.code,{children:"podman"}),". You can replace ",(0,s.jsx)(n.code,{children:"docker..."})," with ",(0,s.jsx)(n.code,{children:"podman..."})," if you're using\nDocker."]})}),"\n",(0,s.jsx)(n.h2,{id:"guide",children:"Guide"}),"\n",(0,s.jsx)(n.h3,{id:"1-clone-the-repository",children:"1. Clone the repository"}),"\n",(0,s.jsx)(n.h4,{id:"11---clone-the-git-repository",children:"1.1 - Clone the git repository"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/mssfoobar/dev-containers\n"})}),"\n",(0,s.jsx)(n.h4,{id:"12---navigate-into-the-root-folder",children:"1.2 - Navigate into the root folder"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd dev-containers\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-set-up-the-environment-variables",children:"2. Set up the environment variables"}),"\n",(0,s.jsxs)(n.p,{children:["By default, the environment variable file already contains all the default values you need to get up and running\nexcept for the ",(0,s.jsx)(n.code,{children:"DEV_PASSWORD"})," & ",(0,s.jsx)(n.code,{children:"DEV_PASSWORD_URL_ENCODED"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title=".env.template"',children:'# Root domain to use for all services\nDEV_DOMAIN=127.0.0.1.nip.io\n\n# Global username and password used for everything\nDEV_USER=admin\n#highlight-start\nDEV_PASSWORD=\n#highlight-end\n\n# Global username and password used for everything - but URL encoded - this is needed for connection strings\n# as some passwords might have special symbols in them, such as "@", causing database connection strings to fail\n# For example, if your DEV_PASSWORD is "strong_p@ssword", in DEV_PASSWORD_URL_ENCODED, it must be "strong_p%40ssword"\nDEV_USER_URL_ENCODED=admin\n#highlight-start\nDEV_PASSWORD_URL_ENCODED=\n#highlight-end\n'})}),"\n",(0,s.jsxs)(n.h4,{id:"21---make-a-copy-of-the-file-and-rename-it-to-env",children:["2.1 - Make a copy of the file and rename it to ",(0,s.jsx)(n.code,{children:".env"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cp .env.template .env\n"})}),"\n",(0,s.jsx)(n.h4,{id:"22---choose-a-suitable-password-and-set-it-for-both-variables",children:"2.2 - Choose a suitable password and set it for both variables."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title=".env"',children:'# Root domain to use for all services\nDEV_DOMAIN=127.0.0.1.nip.io\n\n# Global username and password used for everything\nDEV_USER=admin\n#highlight-start\nDEV_PASSWORD=myfavpassword\n#highlight-end\n\n# Global username and password used for everything - but URL encoded - this is needed for connection strings\n# as some passwords might have special symbols in them, such as "@", causing database connection strings to fail\n# For example, if your DEV_PASSWORD is "strong_p@ssword", in DEV_PASSWORD_URL_ENCODED, it must be "strong_p%40ssword"\nDEV_USER_URL_ENCODED=admin\n#highlight-start\nDEV_PASSWORD_URL_ENCODED=myfavpassword\n#highlight-end\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-run-the-command-for-the-module-you-want",children:"3. Run the command for the module you want"}),"\n",(0,s.jsxs)(n.p,{children:["Every ",(0,s.jsx)(n.code,{children:"compose.yml"})," file in each folder is designed to already include the services they need, simply start it up with\nthe ",(0,s.jsx)(n.code,{children:".env"})," file and apply any overrides you need:"]}),"\n",(0,s.jsxs)(n.h4,{id:"31---example-for-the-ian-module-you-can-run-it-like-so",children:["3.1 - Example, for the ",(0,s.jsx)(n.code,{children:"IAN"})," module, you can run it like so."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"podman compose --env-file .env -f ian/compose.yml -f ./override.yml up -d\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"override.yml"})," is meant for you to fill in overrides for port mapping (for scenarios such as directly accessing\nthe databases with your database management client)."]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["For Docker users, you must use the override to override the default ",(0,s.jsx)(n.code,{children:"traefik"})," settings as it is assuming you\nare using ",(0,s.jsx)(n.code,{children:"Podman"})," - the ",(0,s.jsx)(n.code,{children:"volumes:"})," entry is different to bind to the appropriate ",(0,s.jsx)(n.code,{children:"docker.sock"}),"."]})}),"\n",(0,s.jsxs)(n.p,{children:["In the future, we intend to provide tooling with this information integrated. For now, each module states\nall their dependencies in their respective folders, so if you want to include the ",(0,s.jsx)(n.code,{children:"GIS"}),"\n(Geospatial Information Services) module, look at the ",(0,s.jsx)(n.code,{children:"README.md"})," in it's folder and run that command."]}),"\n",(0,s.jsx)(n.h2,{id:"additional-configuration",children:"Additional Configuration"}),"\n",(0,s.jsx)(n.h4,{id:"wildcard-dns-vs-host-file",children:"Wildcard DNS vs Host file"}),"\n",(0,s.jsx)(n.p,{children:"Custom hostname resolution is required for proper development - the system relies on cookies being forwarded to the\nfront-facing servers for authentication."}),"\n",(0,s.jsxs)(n.p,{children:["You can use a wildcard DNS service like ",(0,s.jsx)(n.code,{children:"https://nip.io"})," or modify your ",(0,s.jsx)(n.code,{children:"/etc/hosts"})," file."]}),"\n",(0,s.jsx)(n.h3,{id:"wildcard-dns-nipio",children:"Wildcard DNS (nip.io)"}),"\n",(0,s.jsxs)(n.p,{children:["If you're using ",(0,s.jsx)(n.code,{children:"nip.io"}),", set the ",(0,s.jsx)(n.code,{children:"DEV_DOMAIN"})," environment variable to get ",(0,s.jsx)(n.code,{children:"nip.io"})," to resolve it to the loopback address:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"DEV_DOMAIN=127.0.0.1.nip.io\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For your web services, make sure the ",(0,s.jsx)(n.code,{children:"PUBLIC_DOMAIN"})," is set appropriately (to nip.io)"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"PUBLIC_DOMAIN=nip.io\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This requires no additional changes to your system - you may then access services via their appropriate subdomain,\nfor example, to visit the Keycloak admin site, you will go to ",(0,s.jsx)(n.a,{href:"http://iams-keycloak.127.0.0.1.nip.io",children:"http://iams-keycloak.127.0.0.1.nip.io"})]}),"\n",(0,s.jsx)(n.h3,{id:"host-file",children:"Host file"}),"\n",(0,s.jsxs)(n.p,{children:["Alternatively, you can modify your ",(0,s.jsx)(n.code,{children:"hosts"})," file to allow your machine to resolve the addresses appropriately, you can do\nthis by adding the values below to your hosts file in ",(0,s.jsx)(n.code,{children:"C:\\Windows\\System32\\Drivers\\etc\\hosts"})," in Windows, or\n",(0,s.jsx)(n.code,{children:"/etc/hosts"})," in Unix systems."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:'language-title="/etc/hosts"',children:"## -------------------- AOH Local Development --------------------\n## ========== Traefik ==========\n127.0.0.1 traefik.localhost\n\n## ========== IAMS ==========\n127.0.0.1 iams-keycloak.localhost iams-aas.localhost iams-web.localhost iams-db.localhost\n\n## ========== Web Base ==========\n127.0.0.1 web-base.localhost\n\n## ========== RTUS ==========\n127.0.0.1 rtus-seh.localhost rtus-pms.localhost rtus-db.localhost\n\n## ========== TAG ==========\n127.0.0.1 tag.localhost tag-web.localhost tag-db.localhost\n\n## ========== UNH ==========\n127.0.0.1 unh.localhost unh-web.localhost unh-db.localhost\n\n## ========== IAN ==========\n127.0.0.1 ian.localhost ian-web.localhost ian-db.localhost\n\n## ========== DASH ==========\n127.0.0.1 dash.localhost dash-web.localhost dash-db.localhost\n\n## ========== GIS ==========\n127.0.0.1 gis.localhost gis-web.localhost gis-db.localhost\n\n## ========== WFE ==========\n127.0.0.1 wfe.localhost wfe-web.localhost wfe-db.localhost\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For your web services, make sure the ",(0,s.jsx)(n.code,{children:"PUBLIC_DOMAIN"})," is left blank, this is a mandatory cookie setting for\nbrowsers when the domain is meant to be ",(0,s.jsx)(n.code,{children:"localhost"}),", you can use the ",(0,s.jsx)(n.code,{children:"compose.override.yml"})," to achieve this."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:'language-title="compose.override.yml"',children:"name: aoh\n\nservices:\n    iams-web:\n        environment:\n            - PUBLIC_DOMAIN=\n\n    ...\n"})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"updating-container-images",children:"Updating Container Images"}),"\n",(0,s.jsxs)(n.p,{children:["By default, the ",(0,s.jsx)(n.code,{children:"dev-containers"})," repository uses ",(0,s.jsx)(n.code,{children:"latest-dev"})," for all our tags. Docker/Podman will not automatically\npull the newest image as we're re-using the 'latest-dev' tag. You'll have to either delete the image locally or\nmanually pull the latest[-dev] tagged image to receive the newest updated images."]}),"\n",(0,s.jsx)(n.h3,{id:"changing-env-vars",children:"Changing Env Vars"}),"\n",(0,s.jsxs)(n.p,{children:["The env vars are used as part of the initialization process - it includes generating users, setting credentials, etc.\nand all these are persisted in the ",(0,s.jsx)(n.code,{children:".data"})," folder as it is used in the Docker volumes. If you need to change any of the\nenvironment variables (",(0,s.jsx)(n.code,{children:"DEV_DOMAIN"}),", ",(0,s.jsx)(n.code,{children:"DEV_USER"})," or ",(0,s.jsx)(n.code,{children:"DEV_PASSWORD"}),"), do not expect the values to be reflected without\nre-initializing everything (you will need to delete ",(0,s.jsx)(n.code,{children:".data"})," and restart everything)."]}),"\n",(0,s.jsx)(n.h3,{id:"unable-to-login-to-keycloak",children:"Unable to login to Keycloak"}),"\n",(0,s.jsxs)(n.p,{children:["Since Keycloak 26, the ",(0,s.jsx)(n.code,{children:"KEYCLOAK_ADMIN"})," and ",(0,s.jsx)(n.code,{children:"KEYCLOAK_PASSWORD"})," have been deprecated and replaced with\n",(0,s.jsx)(n.code,{children:"KC_BOOTSTRAP_ADMIN_USERNAME"})," and ",(0,s.jsx)(n.code,{children:"KC_BOOTSTRAP_ADMIN_PASSWORD"}),". If you are having difficulties logging in, you might be\nusing an older container."]}),"\n",(0,s.jsx)(n.h3,{id:"podman",children:"Podman"}),"\n",(0,s.jsx)(n.h4,{id:"credential-issues-when-migrating-from-docker",children:"Credential issues when migrating from Docker"}),"\n",(0,s.jsxs)(n.p,{children:["There is a common issue you might face when Docker was installed and you are switching over to ",(0,s.jsx)(n.code,{children:"podman"}),". If you are\nable to pull the containers manually, but not when you run ",(0,s.jsx)(n.code,{children:"podman compose ..."})," please visit the following link to see\nhow you can resolve it: ",(0,s.jsx)(n.a,{href:"https://github.com/containers/podman/issues/22682",children:"https://github.com/containers/podman/issues/22682"})]}),"\n",(0,s.jsx)(n.h4,{id:"traefik",children:"Traefik"}),"\n",(0,s.jsxs)(n.p,{children:["For Traefik to perform routing, it needs access to the Docker API via the ",(0,s.jsx)(n.code,{children:"docker.sock"}),", for Podman, that is available\nat ",(0,s.jsx)(n.code,{children:"/run/podman/podman.sock"})," by default. If you're having problems with Traefik look for the ",(0,s.jsx)(n.code,{children:"remoteSocket"})," config:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"podman info\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-title:",metastring:"Sample Output",children:"remoteSocket:\n    exists: true\n    path: /run/podman/podman.sock\n"})}),"\n",(0,s.jsxs)(n.p,{children:['Under "path": You might see something other than ',(0,s.jsx)(n.code,{children:"/run/podman/podman.sock"}),", in that scenario, use the ",(0,s.jsx)(n.code,{children:"override.yml"}),"\nfile to modify it appropriately:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cp override.sample.yml override.yml\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"## Use this override file to override any default configuration\n## Example Use Case: Forward ports to a database you want to access\nname: aoh\n\nservices:\n    traefik:\n        volumes:\n            - /run/user/example/podman.sock:/var/run/docker.sock\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, run the command with the module you want and try again:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"podman compose --env-file .env -f example_module/compose.yml -f override.yml\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>r});var i=o(96540);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);