"use strict";(self.webpackChunk_mssfoobar_docs=self.webpackChunk_mssfoobar_docs||[]).push([[3903],{96043:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"modules/rnr/configuration/configuration","title":"Configuration","description":"DB Snapshot Retention Configuration","source":"@site/docs/modules/rnr/configuration/configuration.mdx","sourceDirName":"modules/rnr/configuration","slug":"/modules/rnr/configuration/","permalink":"/docs/docs/modules/rnr/configuration/","draft":false,"unlisted":false,"editUrl":"https://github.com/mssfoobar/docs/tree/main/docs/modules/rnr/configuration/configuration.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Configuration"},"sidebar":"modulesSidebar","previous":{"title":"Development","permalink":"/docs/docs/modules/rnr/development/"},"next":{"title":"Deployment","permalink":"/docs/docs/modules/rnr/deployment/"}}');var o=t(74848),s=t(28453);const r={sidebar_position:1,sidebar_label:"Configuration"},a="Configuration",l={},c=[{value:"DB Snapshot Retention Configuration",id:"db-snapshot-retention-configuration",level:2},{value:"DebeziumStream Retention Configuration",id:"debeziumstream-retention-configuration",level:2},{value:"Minio Object Expiry Configuration",id:"minio-object-expiry-configuration",level:2},{value:"DB Snapshot Frequency Configuration",id:"db-snapshot-frequency-configuration",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"configuration",children:"Configuration"})}),"\n",(0,o.jsx)(n.h2,{id:"db-snapshot-retention-configuration",children:"DB Snapshot Retention Configuration"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"Replaymgr"})," service ",(0,o.jsx)(n.code,{children:"DB_SNAPSHOT_RETENTION_IN_DAY"})," env variable set how long the data should be kept."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dotenv",children:"DB_SNAP_SHOT_RETENTION_IN_DAY=10\n"})}),"\n",(0,o.jsx)(n.p,{children:"Default value will be set to 7 days if the env variable is not set."}),"\n",(0,o.jsx)(n.h2,{id:"debeziumstream-retention-configuration",children:"DebeziumStream Retention Configuration"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Install ",(0,o.jsx)(n.a,{href:"https://docs.nats.io/using-nats/nats-tools/nats_cli",children:"nats-cli"})," tool"]}),"\n",(0,o.jsx)(n.li,{children:"Create the DebeziumStream (skip to step 3 if the stream exists)"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"nats stream add DebeziumStream --storage=file -s nats://{host}:{port}\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"Edit the stream to write to file system & limit the retention period (for example: 7 days)"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"nats stream edit DebeziumStream --max-age=7d -s nats://{host}:{port}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"minio-object-expiry-configuration",children:"Minio Object Expiry Configuration"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Install minio client tool ",(0,o.jsx)(n.a,{href:"https://min.io/docs/minio/linux/reference/minio-mc.html",children:"mc"})]}),"\n",(0,o.jsxs)(n.li,{children:["Set alias to the minio server (replace placeholder in "," with your environment setup)"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"mc alias set {name} {minio-server-url} {access-key} {secret-key}\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"Use the alias created in step 2 to set the bucket expiry by day"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"mc ilm rule add --expire-days 7 {name}/{bucketname}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"db-snapshot-frequency-configuration",children:"DB Snapshot Frequency Configuration"}),"\n",(0,o.jsx)(n.p,{children:"We use kubernetes cronjob to run bash script to take db snapshot."}),"\n",(0,o.jsx)(n.p,{children:"To update the frequency of the db snapshot, update the kubernetes cronjob yaml file."}),"\n",(0,o.jsxs)(n.p,{children:["For example, update the schedule value in yaml file to ",(0,o.jsx)(n.code,{children:'"*/5 * * *"'})," to set frequency to every 5 minutes."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: batch/v1\nkind: CronJob\nmetadata:\n    name: rnr-periodic-snapshot-raw\n    namespace: common-rnr\nspec:\n    schedule: "*/5 * * * *"\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);